---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="fluid.sh">
    <div class="min-h-screen text-white bg-black">
        <header class="px-6 py-24">
            <div class="mx-auto max-w-2xl">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex gap-3 items-center">
                        <h1 class="text-2xl tracking-tight md:text-3xl font-logo">
                            <span class="text-blue-400">$</span> fluid.sh
                        </h1>
                    </div>
                    <div class="flex gap-6 text-sm font-mono text-neutral-400">
                        <a href="https://github.com/aspectrr/fluid.sh" target="_blank" rel="noopener noreferrer" class="hover:text-neutral-200 transition-colors">GitHub</a>
                        <a href="https://discord.gg/4WGGXJWm8J" target="_blank" rel="noopener noreferrer" class="hover:text-neutral-200 transition-colors">Discord</a>
                    </div>
                </div>
                <p class="mt-2 text-neutral-400">
                    Claude Code for infrastructure. Debug, act, and audit
                    everything Fluid does on your infrastructure.
                </p>

                <p class="mt-4 text-neutral-400">
                    Create sandboxes from VMs, investigate, plan, execute,
                    generate Ansible playbooks, and audit everything.
                </p>
                <h2 class="mt-24 mb-4 text-xl text-neutral-200">
                    Installation
                </h2>
                <div class="px-5 py-4 font-mono text-sm rounded-lg bg-neutral-900">
                    <div class="flex gap-4 justify-between items-center">
                        <div class="text-neutral-400">
                            <span class="select-none text-blue-400">$ </span>curl -fsSL https://fluid.sh/install.sh |
                            bash
                        </div>
                        <button
                            class="p-2 rounded transition-colors text-neutral-600 hover:text-neutral-300 hover:bg-neutral-800"
                            aria-label="Copy to clipboard"
                        >
                            <svg
                                class="w-4 h-4"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                                ></path>
                            </svg>
                        </button>
                    </div>
                    <div class="pt-4 mt-4 border-t border-neutral-800 text-neutral-500">
                        <span class="select-none text-blue-400">$ </span>fluid
                    </div>
                </div>
            </div>
        </header>
        <main class="px-6 pb-24">
            <div class="mx-auto space-y-16 max-w-2xl">
                <section>
                    <h2 class="mb-6 text-xl text-neutral-200">
                        Built for where you already work
                    </h2>

                    <!-- Feature Cards Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-12">
                        <!-- Card 1: Sandbox -->
                        <div class="group p-4 rounded-lg bg-neutral-900/50 border border-neutral-800 hover:border-blue-500/30 transition-all duration-300">
                            <div class="flex items-start gap-3">
                                <div class="text-blue-400 font-mono text-lg">[~]</div>
                                <div>
                                    <h3 class="text-neutral-200 font-medium mb-1">Sandbox Isolation</h3>
                                    <p class="text-neutral-500 text-sm">Clone VMs instantly. Test changes in isolation before touching production.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Card 2: Explore -->
                        <div class="group p-4 rounded-lg bg-neutral-900/50 border border-neutral-800 hover:border-blue-500/30 transition-all duration-300">
                            <div class="flex items-start gap-3">
                                <div class="text-blue-400 font-mono text-lg">ls</div>
                                <div>
                                    <h3 class="text-neutral-200 font-medium mb-1">Context-Aware</h3>
                                    <p class="text-neutral-500 text-sm">Fluid explores your host first - OS, packages, CLI tools - then adapts.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Card 3: Audit -->
                        <div class="group p-4 rounded-lg bg-neutral-900/50 border border-neutral-800 hover:border-blue-500/30 transition-all duration-300">
                            <div class="flex items-start gap-3">
                                <div class="text-blue-400 font-mono text-lg">&gt;&gt;&gt;</div>
                                <div>
                                    <h3 class="text-neutral-200 font-medium mb-1">Full Audit Trail</h3>
                                    <p class="text-neutral-500 text-sm">Every command logged. Every change tracked. Review before production.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Card 4: Ansible -->
                        <div class="group p-4 rounded-lg bg-neutral-900/50 border border-neutral-800 hover:border-blue-500/30 transition-all duration-300">
                            <div class="flex items-start gap-3">
                                <div class="text-blue-400 font-mono text-lg">.yaml</div>
                                <div>
                                    <h3 class="text-neutral-200 font-medium mb-1">Ansible Playbooks</h3>
                                    <p class="text-neutral-500 text-sm">Auto-generates playbooks from sandbox work. Reproducible infrastructure.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Workflow Steps -->
                    <!-- <div class="relative">
                        <h3 class="text-neutral-400 text-sm font-mono mb-4 uppercase tracking-wider">How it works</h3>


                        <div class="hidden md:block absolute top-18 left-0 right-0 h-px bg-neutral-800"></div>
                        <div id="workflow-progress" class="hidden md:block absolute top-18 left-0 h-px bg-linear-to-r from-blue-500 to-blue-400 transition-all duration-1000 ease-out" style="width: 0%;"></div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="workflow-step opacity-0 translate-y-4 transition-all duration-500" data-step="1">
                                <div class="relative flex flex-col items-center text-center">
                                    <div class="w-10 h-10 rounded-full bg-neutral-900 border-2 border-neutral-700 flex items-center justify-center mb-3 transition-all duration-300 workflow-dot">
                                        <span class="text-neutral-500 font-mono text-sm transition-colors duration-300">1</span>
                                    </div>
                                    <span class="text-blue-400 font-mono text-sm mb-1">explore</span>
                                    <span class="text-neutral-600 text-xs">Scan host environment</span>
                                </div>
                            </div>


                            <div class="workflow-step opacity-0 translate-y-4 transition-all duration-500" data-step="2">
                                <div class="relative flex flex-col items-center text-center">
                                    <div class="w-10 h-10 rounded-full bg-neutral-900 border-2 border-neutral-700 flex items-center justify-center mb-3 transition-all duration-300 workflow-dot">
                                        <span class="text-neutral-500 font-mono text-sm transition-colors duration-300">2</span>
                                    </div>
                                    <span class="text-blue-400 font-mono text-sm mb-1">plan</span>
                                    <span class="text-neutral-600 text-xs">Build execution strategy</span>
                                </div>
                            </div>

                            <div class="workflow-step opacity-0 translate-y-4 transition-all duration-500" data-step="3">
                                <div class="relative flex flex-col items-center text-center">
                                    <div class="w-10 h-10 rounded-full bg-neutral-900 border-2 border-neutral-700 flex items-center justify-center mb-3 transition-all duration-300 workflow-dot">
                                        <span class="text-neutral-500 font-mono text-sm transition-colors duration-300">3</span>
                                    </div>
                                    <span class="text-blue-400 font-mono text-sm mb-1">execute</span>
                                    <span class="text-neutral-600 text-xs">Run in sandbox</span>
                                </div>
                            </div>

                            <div class="workflow-step opacity-0 translate-y-4 transition-all duration-500" data-step="4">
                                <div class="relative flex flex-col items-center text-center">
                                    <div class="w-10 h-10 rounded-full bg-neutral-900 border-2 border-neutral-700 flex items-center justify-center mb-3 transition-all duration-300 workflow-dot">
                                        <span class="text-neutral-500 font-mono text-sm transition-colors duration-300">4</span>
                                    </div>
                                    <span class="text-blue-400 font-mono text-sm mb-1">export</span>
                                    <span class="text-neutral-600 text-xs">Generate playbook</span>
                                </div>
                            </div>
                        </div>
                    </div> -->

                    <script>
                        // Workflow animation
                        function initWorkflowAnimation() {
                            const steps = document.querySelectorAll<HTMLElement>('.workflow-step');
                            const progress = document.getElementById('workflow-progress');
                            const workflowStep = document.querySelector('.workflow-step');
                            if (!workflowStep) return;

                            const observer = new IntersectionObserver((entries) => {
                                entries.forEach(entry => {
                                    if (entry.isIntersecting) {
                                        // Animate each step sequentially
                                        steps.forEach((step, index) => {
                                            setTimeout(() => {
                                                step.classList.remove('opacity-0', 'translate-y-4');
                                                step.classList.add('opacity-100', 'translate-y-0');

                                                // Light up the dot
                                                const dot = step.querySelector('.workflow-dot');
                                                const num = step.querySelector('.workflow-dot span');
                                                dot?.classList.remove('border-neutral-700');
                                                dot?.classList.add('border-blue-500', 'shadow-[0_0_10px_2px_rgba(59,130,246,0.3)]');
                                                num?.classList.remove('text-neutral-500');
                                                num?.classList.add('text-blue-400');

                                                // Update progress bar
                                                if (progress) {
                                                    progress.style.width = `${((index + 1) / steps.length) * 100}%`;
                                                }
                                            }, index * 250);
                                        });

                                        observer.disconnect();
                                    }
                                });
                            }, { threshold: 0.5 });

                            observer.observe(workflowStep);
                        }

                        if (document.readyState === 'loading') {
                            document.addEventListener('DOMContentLoaded', initWorkflowAnimation);
                        } else {
                            initWorkflowAnimation();
                        }
                    </script>
                </section>
                <section>
                    <h2 class="mb-4 text-xl text-neutral-200">Usage</h2>

                    <!-- Timeline container -->
                    <div id="usage-timeline" class="relative pl-6">
                        <!-- Vertical timeline line - grows as items appear -->
                        <div id="timeline-line" class="absolute left-3 top-0 w-px bg-linear-to-b from-blue-400 via-neutral-500 to-neutral-600 transition-all duration-500 ease-out" style="height: 0;"></div>

                        <!-- User Prompt - Blue accent -->
                        <div class="timeline-item relative mb-3 opacity-0" data-color="blue">
                            <div class="timeline-dot absolute -left-4 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="px-4 py-3 font-mono text-sm rounded-lg bg-neutral-900 border-l-2 border-neutral-700 transition-all duration-300 text-neutral-300">
                                <span class="text-blue-400">$</span> <span id="typed-prompt"></span><span id="cursor" class="animate-pulse">|</span>
                            </div>
                        </div>

                        <!-- Sandbox Info -->
                        <div class="timeline-item relative mb-1 opacity-0" data-color="neutral" data-tool="create_sandbox" data-command="Creating sandbox...">
                            <div class="timeline-dot absolute -left-4 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="timeline-content px-4 py-2 font-mono text-sm rounded-lg bg-neutral-900/70 text-neutral-300">
                                <div class="loading-state hidden">
                                    <span class="loading-dots text-blue-400"></span>
                                    <span class="text-neutral-400 ml-2">Creating sandbox...</span>
                                </div>
                                <div class="result-state hidden">
                                    <div class="text-blue-400">v create_sandbox</div>
                                    <div class="text-neutral-400">ID: SBX-demo1234</div>
                                    <div class="text-neutral-400">IP: 192.168.122.50</div>
                                    <div class="text-neutral-400">State: RUNNING</div>
                                </div>
                            </div>
                        </div>

                        <!-- OS Detection -->
                        <div class="timeline-item relative mb-1 opacity-0" data-color="neutral" data-tool="run_command" data-command="cat /etc/os-release">
                            <div class="timeline-dot absolute -left-4 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="timeline-content px-4 py-2 font-mono text-sm rounded-lg bg-neutral-900/70 text-neutral-300">
                                <div class="loading-state hidden">
                                    <span class="loading-dots text-blue-400"></span>
                                    <span class="text-neutral-400 ml-2">Running: <span class="text-neutral-300">cat /etc/os-release</span></span>
                                </div>
                                <div class="result-state hidden">
                                    <div class="text-blue-400">v run_command</div>
                                    <div class="text-neutral-400">exit: 0</div>
                                    <div class="text-neutral-400">NAME="Ubuntu"</div>
                                    <div class="text-neutral-400">VERSION="22.04.3 LTS (Jammy Jellyfish)"</div>
                                </div>
                            </div>
                        </div>

                        <!-- Package Update -->
                        <div class="timeline-item relative mb-1 opacity-0" data-color="neutral" data-tool="run_command" data-command="apt update">
                            <div class="timeline-dot absolute -left-4 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="timeline-content px-4 py-2 font-mono text-sm rounded-lg bg-neutral-900/70 text-neutral-300">
                                <div class="loading-state hidden">
                                    <span class="loading-dots text-blue-400"></span>
                                    <span class="text-neutral-400 ml-2">Running: <span class="text-neutral-300">apt update</span></span>
                                </div>
                                <div class="result-state hidden">
                                    <div class="text-blue-400">v run_command</div>
                                    <div class="text-neutral-500 pl-4">exit: 0</div>
                                    <div class="text-neutral-500 pl-4">Hit:1 http://archive.ubuntu.com/ubuntu jammy InRelease</div>
                                    <div class="text-neutral-500 pl-4">Get:2 http://archive.ubuntu.com/ubuntu jammy-updates InRelease [119 kB]</div>
                                    <div class="text-neutral-500 pl-4">Reading package lists... Done</div>
                                    <div class="text-neutral-600 pl-4">... (2 more lines)</div>
                                </div>
                            </div>
                        </div>

                        <!-- Install Apache -->
                        <div class="timeline-item relative mb-1 opacity-0" data-color="neutral" data-tool="run_command" data-command="apt install -y apache2">
                            <div class="timeline-dot absolute -left-4 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="timeline-content px-4 py-2 font-mono text-sm rounded-lg bg-neutral-900/70 text-neutral-300">
                                <div class="loading-state hidden">
                                    <span class="loading-dots text-blue-400"></span>
                                    <span class="text-neutral-400 ml-2">Running: <span class="text-neutral-300">apt install -y apache2</span></span>
                                </div>
                                <div class="result-state hidden">
                                    <div class="text-blue-400">v run_command</div>
                                    <div class="text-neutral-500">exit: 0</div>
                                    <div class="text-neutral-500 pl-4">Reading package lists... Done</div>
                                    <div class="text-neutral-500 pl-4">Building dependency tree... Done</div>
                                    <div class="text-neutral-500 pl-4">The following NEW packages will be installed:</div>
                                    <div class="text-neutral-600 pl-4">... (7 more lines)</div>
                                </div>
                            </div>
                        </div>

                        <!-- Create HTML file -->
                        <div class="timeline-item relative mb-1 opacity-0" data-color="neutral" data-tool="run_command" data-command="echo '&lt;h1&gt;Hello&lt;/h1&gt;' > /var/www/html/index.html">
                            <div class="timeline-dot absolute -left-4 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="timeline-content px-4 py-2 font-mono text-sm rounded-lg bg-neutral-900/70 text-neutral-300">
                                <div class="loading-state hidden">
                                    <span class="loading-dots text-blue-400"></span>
                                    <span class="text-neutral-400 ml-2">Running: <span class="text-neutral-300">echo '...' &gt; /var/www/html/index.html</span></span>
                                </div>
                                <div class="result-state hidden">
                                    <div class="text-blue-400">v run_command</div>
                                    <div class="text-neutral-500">exit: 0</div>
                                </div>
                            </div>
                        </div>

                        <!-- Service Status -->
                        <div class="timeline-item relative mb-1 opacity-0" data-color="neutral" data-tool="run_command" data-command="systemctl status apache2">
                            <div class="timeline-dot absolute -left-4 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="timeline-content px-4 py-2 font-mono text-sm rounded-lg bg-neutral-900/70 text-neutral-300">
                                <div class="loading-state hidden">
                                    <span class="loading-dots text-blue-400"></span>
                                    <span class="text-neutral-400 ml-2">Running: <span class="text-neutral-300">systemctl status apache2</span></span>
                                </div>
                                <div class="result-state hidden">
                                    <div class="text-blue-400">v run_command</div>
                                    <div class="text-neutral-500">exit: 0</div>
                                    <div class="text-neutral-400">‚óè apache2.service - The Apache HTTP Server</div>
                                    <div class="text-neutral-500 pl-4">Loaded: loaded (/lib/systemd/system/apache2.service; enabled)</div>
                                    <div class="text-neutral-500 pl-4">Active: active (running) since Sat 2026-01-25 12:00:00 UTC</div>
                                </div>
                            </div>
                        </div>

                        <!-- Verification -->
                        <div class="timeline-item relative mb-1 opacity-0" data-color="neutral" data-tool="run_command" data-command="curl localhost">
                            <div class="timeline-dot absolute -left-4 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="timeline-content px-4 py-2 font-mono text-sm rounded-lg bg-neutral-900/70 text-neutral-300">
                                <div class="loading-state hidden">
                                    <span class="loading-dots text-blue-400"></span>
                                    <span class="text-neutral-400 ml-2">Running: <span class="text-neutral-300">curl localhost</span></span>
                                </div>
                                <div class="result-state hidden">
                                    <div class="text-blue-400">v run_command</div>
                                    <div class="text-neutral-500">exit: 0</div>
                                    <div class="break-all text-neutral-500">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Fluid Demo&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Hello fr...</div>
                                </div>
                            </div>
                        </div>

                        <!-- Playbook Creation -->
                        <div class="timeline-item relative mb-1 opacity-0" data-color="amber" data-tool="create_playbook" data-command="Creating playbook...">
                            <div class="timeline-dot absolute -left-4 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="timeline-content px-4 py-2 font-mono text-sm rounded-lg bg-neutral-900/70 border-l-2 border-transparent transition-all duration-300 text-neutral-300">
                                <div class="loading-state hidden">
                                    <span class="loading-dots text-amber-400"></span>
                                    <span class="text-neutral-400 ml-2">Creating playbook...</span>
                                </div>
                                <div class="result-state hidden">
                                    <div class="text-amber-400">v create_playbook</div>
                                    <div class="text-neutral-400 pl-4">Playbook: httpd-setup</div>
                                </div>
                            </div>
                        </div>

                        <!-- Playbook Tasks -->
                        <div class="timeline-item relative mb-1 opacity-0" data-color="amber" data-tool="add_playbook_task" data-command="Adding tasks...">
                            <div class="timeline-dot absolute -left-4 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="timeline-content px-4 py-2 font-mono text-sm rounded-lg bg-neutral-900/70 border-l-2 border-transparent transition-all duration-300 text-neutral-300">
                                <div class="loading-state hidden">
                                    <span class="loading-dots text-amber-400"></span>
                                    <span class="text-neutral-400 ml-2">Adding playbook tasks...</span>
                                </div>
                                <div class="result-state hidden">
                                    <div class="text-amber-400/80">v add_playbook_task <span class="text-neutral-500">x4</span></div>
                                    <div class="text-neutral-500 pl-4">Playbook: httpd-setup</div>
                                    <div class="text-neutral-500 pl-4">Tasks: TASK-001, TASK-002, TASK-003, TASK-004</div>
                                </div>
                            </div>
                        </div>

                        <!-- Final Summary -->
                        <div class="timeline-item relative opacity-0" data-color="green" data-tool="summary">
                            <div class="timeline-dot absolute -left-3 top-3 w-2 h-2 rounded-full bg-neutral-700 transition-all duration-300"></div>
                            <div class="timeline-content px-4 py-3 font-mono text-sm rounded-lg bg-neutral-900 border-l-2 border-transparent transition-all duration-300 text-neutral-300">
                                <div class="text-green-400 mb-2 font-semibold">Done! Here's what I accomplished:</div>

                                <div class="mb-2">
                                    <span class="text-neutral-200 underline">Sandbox Created</span>
                                    <div class="text-neutral-400">- ID: SBX-demo1234</div>
                                    <div class="text-neutral-400">- IP: 192.168.122.50</div>
                                </div>

                                <div class="mb-2">
                                    <span class="text-neutral-200 underline">Apache HTTP Server</span>
                                    <div class="text-neutral-400">- Installed and running</div>
                                    <div class="text-neutral-400">- Custom page at /var/www/html/index.html</div>
                                    <div class="text-neutral-400">- Verified working with curl</div>
                                </div>

                                <div class="mb-2">
                                    <span class="text-neutral-200 underline">Ansible Playbook: httpd-setup</span>
                                    <div class="text-neutral-400">The playbook includes 4 tasks:</div>
                                    <div class="text-neutral-500 pl-4">1. Update apt cache</div>
                                    <div class="text-neutral-500 pl-4">2. Install Apache</div>
                                    <div class="text-neutral-500 pl-4">3. Create custom index.html</div>
                                    <div class="text-neutral-500 pl-4">4. Start and enable Apache service</div>
                                </div>

                                <div class="mt-3 italic text-neutral-600 text-xs">
                                    You can run this playbook on any Ubuntu server to reproduce this setup.
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <style>
                    .loading-dots::before {
                        content: '';
                        animation: loadingDots 1.4s infinite;
                    }
                    @keyframes loadingDots {
                        0%, 20% { content: '.'; }
                        40% { content: '..'; }
                        60%, 100% { content: '...'; }
                    }
                </style>

                <script>
                    // Typing sequence with typos: [action, text]
                    // 'type' = add char, 'delete' = remove char, 'pause' = wait
                    const typingSequence = [
                        ...Array.from("Hey I am trying to steup").flatMap(c => [['type', c]]),
                        ['pause', 200],
                        ['delete', ''], ['delete', ''], ['delete', ''],['delete', ''], // delete "teup"
                        ['pause', 100],
                        ...Array.from("etup a htpd").flatMap(c => [['type', c]]),
                        ['pause', 150],
                        ['delete', ''], ['delete', ''], // delete "pd"
                        ...Array.from("tpd server on host-1, can you figure out what OS is on that host and setup a httpd server hosting a test html file?").flatMap(c => [['type', c]]),
                    ];

                    interface DotColor {
                        dot: string;
                        glow: string;
                        border: string;
                    }

                    const dotColors: Record<string, DotColor> = {
                        blue: { dot: 'bg-blue-400', glow: 'shadow-[0_0_8px_2px_rgba(96,165,250,0.6)]', border: 'border-blue-400' },
                        neutral: { dot: 'bg-neutral-400', glow: 'shadow-[0_0_6px_1px_rgba(163,163,163,0.4)]', border: 'border-neutral-600' },
                        amber: { dot: 'bg-amber-400', glow: 'shadow-[0_0_8px_2px_rgba(251,191,36,0.5)]', border: 'border-amber-400/50' },
                        green: { dot: 'bg-green-400', glow: 'shadow-[0_0_8px_2px_rgba(74,222,128,0.6)]', border: 'border-green-400' },
                    };

                    // Loading duration varies by command type
                    const loadingDurations: Record<string, number> = {
                        'create_sandbox': 5000,
                        'run_command': 1000,
                        'create_playbook': 500,
                        'add_playbook_task': 600,
                        'summary': 600,
                    };

                    let currentText = '';
                    let sequenceIndex = 0;
                    let timelineStarted = false;

                    function typeNext() {
                        if (sequenceIndex >= typingSequence.length) {
                            // Done typing, hide cursor and start timeline
                            const cursor = document.getElementById('cursor');
                            if (cursor) cursor.style.display = 'none';
                            setTimeout(startTimeline, 400);
                            return;
                        }

                        const [action, char] = typingSequence[sequenceIndex];
                        sequenceIndex++;

                        if (action === 'type') {
                            currentText += char;
                            const typedPrompt = document.getElementById('typed-prompt');
                            if (typedPrompt) typedPrompt.textContent = currentText;
                            setTimeout(typeNext, 30 + Math.random() * 40);
                        } else if (action === 'delete') {
                            currentText = currentText.slice(0, -1);
                            const typedPrompt = document.getElementById('typed-prompt');
                            if (typedPrompt) typedPrompt.textContent = currentText;
                            setTimeout(typeNext, 50);
                        } else if (action === 'pause' && typeof char === 'number') {
                            setTimeout(typeNext, char);
                        }
                    }

                    function updateTimelineHeight(items: HTMLElement[], upToIndex: number) {
                        const timeline = document.getElementById('timeline-line');
                        if (!timeline) return;
                        let height = 0;
                        for (let i = 0; i <= upToIndex; i++) {
                            if (items[i]) {
                                height += items[i].offsetHeight + (i < upToIndex ? 4 : 0);
                            }
                        }
                        timeline.style.height = `${height}px`;
                    }

                    function showItem(item: HTMLElement, index: number, items: HTMLElement[]) {
                        // Show item
                        item.classList.remove('opacity-0');
                        item.classList.add('opacity-100');

                        // Light up dot with pulsing during loading
                        const dot = item.querySelector('.timeline-dot');
                        if (!dot) return;
                        const color = item.dataset.color || 'neutral';
                        const colors = dotColors[color];
                        const tool = item.dataset.tool || '';

                        dot.classList.remove('bg-neutral-700');
                        dot.classList.add(colors.dot, colors.glow);

                        // Grow timeline to include this item
                        updateTimelineHeight(items, index);

                        // Check if this item has loading/result states
                        const loadingState = item.querySelector('.loading-state');
                        const resultState = item.querySelector('.result-state');

                        if (loadingState && resultState) {
                            // Show loading state first
                            loadingState.classList.remove('hidden');
                            dot.classList.add('animate-pulse');

                            // After loading duration, show result
                            const duration = loadingDurations[tool] || 500;
                            setTimeout(() => {
                                loadingState.classList.add('hidden');
                                resultState.classList.remove('hidden');
                                dot.classList.remove('animate-pulse');

                                // Update height after content change
                                updateTimelineHeight(items, index);

                                // Add border accent for special items
                                if (color !== 'neutral') {
                                    const content = item.querySelector('.timeline-content');
                                    if (content) {
                                        content.classList.remove('border-transparent');
                                        content.classList.add(colors.border);
                                    }
                                }
                            }, duration);
                        } else {
                            // No loading state (like the final summary)
                            if (color !== 'neutral') {
                                const content = item.querySelector('.timeline-content') || item.querySelector('.px-4');
                                if (content) {
                                    content.classList.remove('border-neutral-700', 'border-transparent');
                                    content.classList.add(colors.border);
                                }
                            }
                        }
                    }

                    function startTimeline() {
                        if (timelineStarted) return;
                        timelineStarted = true;

                        const items = Array.from(document.querySelectorAll<HTMLElement>('.timeline-item'));

                        // Skip the first item (prompt) as it's already shown
                        const toolItems = items.slice(1);

                        let delay = 0;
                        toolItems.forEach((item, index) => {
                            const tool = item.dataset.tool || '';
                            const loadingDuration = loadingDurations[tool] || 500;

                            setTimeout(() => {
                                showItem(item, index + 1, items);
                            }, delay);

                            // Next item appears after loading completes + small gap
                            delay += loadingDuration + 200;
                        });
                    }

                    // Start animation when section is in view
                    function initAnimation() {
                        const timeline = document.getElementById('usage-timeline');
                        if (!timeline) return;
                        const observer = new IntersectionObserver((entries) => {
                            entries.forEach(entry => {
                                if (entry.isIntersecting) {
                                    const items = Array.from(document.querySelectorAll<HTMLElement>('.timeline-item'));
                                    const firstItem = items[0];
                                    if (!firstItem) return;

                                    // Show first item (prompt box) immediately
                                    firstItem.classList.remove('opacity-0');
                                    firstItem.classList.add('opacity-100');

                                    // Light up the prompt dot
                                    const dot = firstItem.querySelector('.timeline-dot');
                                    if (dot) {
                                        dot.classList.remove('bg-neutral-700');
                                        dot.classList.add('bg-blue-400', 'shadow-[0_0_8px_2px_rgba(96,165,250,0.6)]');
                                    }

                                    // Update border
                                    const content = firstItem.querySelector('.px-4');
                                    if (content) {
                                        content.classList.remove('border-neutral-700');
                                        content.classList.add('border-blue-400');
                                    }

                                    // Set initial timeline height to just the first item
                                    updateTimelineHeight(items, 0);

                                    // Start typing
                                    setTimeout(typeNext, 500);
                                    observer.disconnect();
                                }
                            });
                        }, { threshold: 0.3 });

                        observer.observe(timeline);
                    }

                    // Init on page load
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', initAnimation);
                    } else {
                        initAnimation();
                    }
                </script>
            </div>
        </main>
    </div>
</BaseLayout>
